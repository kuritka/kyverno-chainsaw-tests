apiVersion: chainsaw.kyverno.io/v1alpha1
kind: Test
metadata:
  name: pod-test
spec:
  bindings:
    - name: namespace
      value: kube-public
  steps:
    - try:
        - apply:
            timeout: 1m
            resource:
              apiVersion: v1
              kind: ConfigMap
              metadata:
                name: (join('-', [$namespace, 'cm']))
              data:
                foo: bar
        - assert:
            resource:
              apiVersion: apps/v1
              kind: Deployment
              metadata:
                labels:
                  k8s-app: kube-dns
                namespace: kube-system
              spec:
                (replicas >= `1` && replicas < `4`): true
                template:
                  spec:
                    # the `~` modifier tells Chainsaw to iterate over the array elements
                    ~.(containers):
                      securityContext: { }
